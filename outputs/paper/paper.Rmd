---
title: "Data from open data Toronto on Covid-19 and the amount of affected people in Toronto"
author: "Swarnadeep Chattopadhyay"
thanks: "https://github.com/WanteXecutioN/Sta304-Assignment-"
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "This paper is regarding the Covid-19 cases in Toronto. The city of Toronto has been able to collect data on a daily basis and present it to the public for their use. This paper portrays figures such as graphs and tables in order for the readers to have a visual of the data. The results were rather astonishing as it provides an in depth visual of who or where the most cases occurred. The paper concludes by discussing the data and provides any biases that resulted from the data."
output:
  bookdown::pdf_document2
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(palmerpenguins)
```

```{r, include=FALSE}
library(opendatatoronto)
library(dplyr)

# get package
package <- show_package("64b54586-6180-4485-83eb-81e8fae3b8fe")
package

# get all resources for this package
resources <- list_package_resources("64b54586-6180-4485-83eb-81e8fae3b8fe")

# identify datastore resources; by default, Toronto Open Data sets datastore resource format to CSV for non-geospatial and GeoJSON for geospatial resources
datastore_resources <- filter(resources, tolower(format) %in% c('csv', 'geojson'))

# load the first datastore resource as a sample
covid_data <- filter(datastore_resources, row_number()==1) %>% get_resource()
covid_data
```

```{r, echo=FALSE}
library(tidyverse)
library(ggplot2)
library(ggpubr)

#removing the spaces in column headings
names(covid_data) <- str_replace_all(names(covid_data), c(" " = "." , "," = "" ))

#Top Toronto Neighbourhoods case count
nbr_ct <- data.frame(sort(table(covid_data$Neighbourhood.Name), decreasing = TRUE))
knitr::kable(head(nbr_ct, 10), "pipe", col.name =c("Neighbourhood Name", "Number of Cases"), align = c("l", "c"))

knitr::kable(head(covid_data, 5), "pipe")

#Create a copy of original data to add columns for Year and Year & Month
c19_cpy <- covid_data
c19_cpy$Yr <- format(as.Date(covid_data$Reported.Date), "%Y")
c19_cpy$Yr_Mth <- format(as.Date(covid_data$Reported.Date), "%Y-%m")

#Case Count by year
ggplot(c19_cpy, aes(Yr, ..count..))+
  geom_bar(aes(fill = Yr), alpha = 0.5)+
  geom_text(aes(label = after_stat(count)), vjust = 0, stat = "count")+
  labs(x = "Year", y = "Number of Cases", title = "YTD Numbers")

#Case Count by Months
Yr_20 <- c19_cpy %>% 
          filter(Yr == "2020") %>% 
          ggplot(aes(Yr_Mth, ..count..))+
          geom_bar(aes(fill = Yr_Mth), alpha = 0.5)+
          labs(x = "Months", y = "Number of Cases", title = "Monthly Numbers")+
          theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

Yr_21 <- c19_cpy %>% 
          filter(Yr == "2021") %>% 
          ggplot(aes(Yr_Mth, ..count..))+
          geom_bar(aes(fill = Yr_Mth), alpha = 0.5)+
          labs(x = "Months", y = "Number of Cases", title = "Monthly Numbers")+
          theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

Yr_22 <- c19_cpy %>% 
          filter(Yr == "2022") %>% 
          ggplot(aes(Yr_Mth, ..count..))+
          geom_bar(aes(fill = Yr_Mth), alpha = 0.5)+
          labs(x = "Months", y = "Number of Cases", title = "Monthly Numbers")+
          theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

ggarrange(Yr_20, Yr_21, Yr_22,
          labels = c("2020", "2021", "2022"),
          nrow = 3)

#Total case count by age groups
ggplot(covid_data, aes(Age.Group, ..count..))+
  geom_bar(aes(fill = Age.Group), alpha = 0.5)+
  labs(x = "Age Groups", y = "Number of Cases", title = "Cases by Age groups")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

#leading factors for covid infections
ggplot(covid_data, aes(Source.of.Infection, ..count..))+
  geom_bar(aes(fill = Source.of.Infection), alpha = 0.5)+
  labs(x = "Sources", y = "Number of Cases", title = "Factors leading to cases")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  coord_flip()
```

# Introduction

You can and should cross-reference sections and sub-sections. For instance, Section \@ref(data). R Markdown automatically makes the sections lower case and adds a dash to spaces to generate labels, for instance, Section \@ref(first-discussion-point). 

Covid-19 is a global pandemic which started back in 2019 and has been evolving since. In order to measure the people affected by this disease, the City of Toronto has launched a data set which provides how many people have been affected and other factors such as gender, age, neighborhood etc. This data can be retrieved from @citeopendatatoronto. With the help of @citeR, I was able to create visuals using @citeggplot2 which helps the readers understand the data better. 


In this paper, we look closely at how Covid has affected in terms of age groups, neighborhoods and which year had the highest cases recorded. In terms of age group, 20-40 years saw the highest amount of cases recorded. In terms of neighborhoods,... saw the highest number of cases. As for which year, it was 2021. These will help us create an understanding of who has been affected the most or which area has been hit the hardest. In the next section, we will look at these data and discuss in detail as to what the visuals are telling us and what it could mean. 


In terms of omitting any bias, I decided to include all the data to make sure the results were accurate. This however took long as loading the data was difficult at first but it eventually got faster as the more times I ran the code. In terms of bias in the data itself like age groups, neighborhoods and year, we will discuss what could have caused them. 

# Data

Our data is of penguins (Figure \@ref(fig:bills)).

```{r bills, fig.cap="Bills of penguins", echo = FALSE}
ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("darkorange","purple","cyan4"),
                    guide = FALSE) +
  theme_minimal() +
  facet_wrap(~species, ncol = 1) +
  coord_flip()
```

Talk more about it.

Also bills and their average (Figure \@ref(fig:billssssss)). (Notice how you can change the height and width so they don't take the whole page?)

```{r billssssss, fig.cap="More bills of penguins", echo = FALSE, fig.width=8, fig.height=4}

# This needs to be about the random data tha tI sasmpled?
ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("darkorange","purple","cyan4"),
                    guide = FALSE) +
  theme_minimal() +
  facet_wrap(~species, ncol = 1) +
  coord_flip()
```

Talk way more about it. 



# Model

\begin{equation}
Pr(\theta | y) = \frac{Pr(y | \theta) Pr(\theta)}{Pr(y)}  (\#eq:bayes)
\end{equation}

Equation \@ref(eq:bayes) seems useful, eh?

Here's a dumb example of how to use some references: In paper we run our analysis in `R` [@citeR]. We also use the `tidyverse` which was written by @thereferencecanbewhatever If we were interested in baseball data then @citeLahman could be useful. 

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

# Discussion

## First discussion point

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional details


\newpage


# References


